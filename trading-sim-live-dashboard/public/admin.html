<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trading Simulation Admin</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=Bebas+Neue&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css" />
</head>
<body class="admin-page">
  <main class="admin-layout">
    <section id="loginPanel" class="card admin-card">
      <h1>Admin Login</h1>
      <p>Use the admin password from your `ADMIN_PASSWORD` environment variable.</p>
      <form id="loginForm" class="stack-form">
        <input id="passwordInput" type="password" placeholder="Admin password" required />
        <button type="submit">Enter Admin Panel</button>
      </form>
      <p id="loginError" class="error-text"></p>
    </section>

    <section id="adminPanel" class="hidden">
      <header class="admin-header">
        <div class="admin-title-block">
          <img src="/bexhill-logo.svg" alt="Bexhill 6th Form College" class="site-logo site-logo-small" />
          <h1>Trading Simulation Control Center</h1>
        </div>
        <div class="inline-actions">
          <a class="ghost-button" href="/" target="_blank" rel="noreferrer">Open Public Dashboard</a>
          <button id="logoutBtn" class="ghost-button">Logout</button>
        </div>
      </header>

      <div class="admin-grid">
        <section class="card admin-card">
          <h2>Game Settings</h2>
          <form id="metaForm" class="stack-form">
            <input id="titleInput" placeholder="Game title" />
            <input id="subtitleInput" placeholder="Subtitle" />
            <textarea id="announcementInput" rows="3" placeholder="Announcement"></textarea>
            <label class="checkbox-line">
              <input id="pausedInput" type="checkbox" /> Pause game (buzzer state)
            </label>
            <button type="submit">Save Settings</button>
          </form>
          <div class="inline-actions wrap">
            <button id="buzzerBtn" class="danger">Buzzer: Stop All</button>
            <button id="resumeBtn" class="success">Resume Trading</button>
            <button id="revealWinnerBtn" class="winner-btn">Reveal Winner</button>
            <button id="hideWinnerBtn" class="ghost-button">Hide Reveal</button>
          </div>
        </section>

        <section class="card admin-card">
          <h2>Round Control</h2>
          <div class="round-nav">
            <button id="prevRoundBtn" class="ghost-button" type="button">Previous Round</button>
            <div id="activeRoundLabel" class="round-active">Round 1</div>
            <button id="nextRoundBtn" class="ghost-button" type="button">Next Round</button>
          </div>
          <div id="roundButtons" class="round-buttons"></div>
          <form id="roundPricesForm" class="stack-form">
            <label><strong>Square</strong><input id="rp_square" type="number" min="0" step="1" required /></label>
            <label><strong>Circle</strong><input id="rp_circle" type="number" min="0" step="1" required /></label>
            <label><strong>Equilateral Triangle</strong><input id="rp_equilateral_triangle" type="number" min="0" step="1" required /></label>
            <label><strong>Isosceles Triangle</strong><input id="rp_isosceles_triangle" type="number" min="0" step="1" required /></label>
            <label><strong>Semi Circle</strong><input id="rp_semi_circle" type="number" min="0" step="1" required /></label>
            <button type="submit">Save Prices For Selected Round</button>
          </form>
          <p class="list-sub">Shape order matches your live cards: Square, Circle, Equilateral Triangle, Isosceles Triangle, Semi Circle.</p>
        </section>

        <section class="card admin-card">
          <h2>Add Team</h2>
          <form id="teamForm" class="stack-form">
            <input id="teamNameInput" placeholder="Team / Country name" required />
            <input id="teamFlagInput" placeholder="Image URL (optional)" />
            <button type="submit">Add Team</button>
          </form>
          <form id="teamImportForm" class="stack-form" style="margin-top:12px;">
            <label for="teamImportFile"><strong>Bulk import teams</strong> (.csv, .xls, .xlsx)</label>
            <input id="teamImportFile" type="file" accept=".csv,.xls,.xlsx" required />
            <button type="submit" class="ghost-button">Upload Team File</button>
            <p class="list-sub">Use column headers like <code>name</code> or <code>team</code>. Optional image column: <code>flagUrl</code>, <code>flag</code>, or <code>image</code>.</p>
          </form>
          <div id="teamList" class="list-stack"></div>
        </section>

        <section class="card admin-card">
          <h2>Shape Prices</h2>
          <form id="shapeForm" class="stack-form">
            <select id="shapeKindInput" required>
              <option value="square">Square</option>
              <option value="circle">Circle</option>
              <option value="equilateral_triangle">Equilateral Triangle</option>
              <option value="isosceles_triangle">Isosceles Triangle</option>
              <option value="semi_circle">Semi Circle</option>
            </select>
            <input id="shapeNameInput" placeholder="Shape name" required />
            <input id="shapePriceInput" type="number" min="0" step="1" placeholder="Price" required />
            <input id="shapeColorInput" type="color" value="#1f6f8b" />
            <button type="submit">Add Shape</button>
          </form>
          <div id="shapeList" class="list-stack"></div>
        </section>

        <section class="card admin-card">
          <h2>Record Batch Sale</h2>
          <form id="transactionForm" class="stack-form">
            <select id="txTeamSelect" required></select>
            <select id="txShapeSelect" required></select>
            <input id="txAcceptedInput" type="number" min="0" step="1" value="1" placeholder="Accepted quantity" required />
            <input id="txRejectedInput" type="number" min="0" step="1" value="0" placeholder="Rejected quantity" required />
            <input id="txNoteInput" placeholder="Optional note" />
            <button type="submit">Record Sale</button>
          </form>
        </section>

        <section class="card admin-card wide">
          <h2>Recent Activity</h2>
          <div id="txList" class="list-stack"></div>
          <div class="inline-actions wrap">
            <button id="resetKeepBtn" class="ghost-button">Reset Scores (Keep teams & shapes)</button>
            <button id="resetAllBtn" class="danger">Reset Everything</button>
          </div>
        </section>
      </div>
      <p id="adminStatus" class="status-text"></p>
    </section>
  </main>

  <script src="/socket.io/socket.io.js"></script>
  <script src="/admin.js"></script>
</body>
</html>
